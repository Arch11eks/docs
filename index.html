<!doctype html>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Fuel Finder</title>
<style>
  body{font:14px system-ui;margin:0;background:#0f0f10;color:#eee}
  .wrap{max-width:720px;margin:20px auto;padding:12px}
  .card{background:#15161a;border:1px solid #26282d;border-radius:12px;padding:12px}
  label{display:block;font-size:12px;color:#9aa0a6;margin:8px 0 4px}
  select,button{width:100%;padding:10px;border-radius:10px;border:1px solid #2a2b30;background:#101114;color:#eee}
  .grid{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .list{margin-top:12px;display:grid;gap:10px}
  .item{background:#121317;border:1px solid #23252a;border-radius:10px;padding:10px}
  .muted{color:#9aa0a6}
  .price{font-weight:700}
</style>
<div class="wrap">
  <h2>⛽ Fuel Finder</h2>
  <div class="card">
    <div class="grid">
      <div><label>Страна</label><select id="country"></select></div>
      <div><label>Город</label><select id="city"><option value="">Все</option></select></div>
      <div><label>Топливо</label>
        <select id="fuel"><option>95</option><option>98</option><option>diesel</option><option>lpg</option></select>
      </div>
    </div>
    <div style="margin-top:10px"><button id="apply">Показать</button></div>
    <div class="muted" id="meta"></div>
  </div>
  <div class="list" id="list"></div>
</div>
<script>
const API_BASE = "https://<invoke-id>.execute-api.eu-north-1.amazonaws.com"; // <-- подставь свой
const els = {country:country, city:city, fuel:fuel, list:list, meta:meta, apply:apply};

async function j(url){ const r = await fetch(url,{mode:'cors'}); if(!r.ok) throw new Error(await r.text()); return r.json(); }

async function loadCountries(){
  const jmeta = await j(`${API_BASE}/meta`);
  els.country.innerHTML = jmeta.countries.map(c=>`<option>${c}</option>`).join('');
  await onCountryChange();
}
async function onCountryChange(){
  const c = els.country.value;
  const jmeta = await j(`${API_BASE}/meta?country=`+encodeURIComponent(c));
  els.city.innerHTML = `<option value="">Все</option>` + jmeta.cities.map(ci=>`<option>${ci}</option>`).join('');
}
country.addEventListener('change', onCountryChange);

async function apply(){
  const qs = new URLSearchParams({
    country: els.country.value || '',
    city: els.city.value || '',
    fuel: els.fuel.value || '95',
    limit: 20
  });
  const data = await j(`${API_BASE}/search?`+qs.toString());
  els.meta.textContent = `Найдено: ${data.items.length}`;
  els.list.innerHTML = data.items.map((it,i)=>`
    <div class="item">
      <div><b>${i+1}. ${it.name}</b> — <span class="price">${Number(it.price).toFixed(3)} €/л</span></div>
      <div class="muted">${[it.country,it.city].filter(Boolean).join(' · ')}</div>
      <div class="muted">${it.address||''}</div>
    </div>`).join('') || '<div class="item"><span class="muted">Пусто</span></div>';
}
apply.onclick = apply;

loadCountries().then(apply);
</script>
